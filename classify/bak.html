<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script type="text/javascript" src="./raw.js"></script>
    <script type="text/javascript" src="./easy.js"></script>
    <style>
      #words {
        width: 350px;
        /* font-size: 15px; */
      }

      .line {
        display: flex;
        height: 30px;
        font-size: 20px;
      }

      .div_word {
        flex: 2;
      }

      .div_easy {
        flex: 1;
      }

      .div_hard {
        flex: 1;
      }
    </style>
    <title>单词分类</title>
  </head>

  <body>
    <div>
      <div>
        共有<span id="total"></span>个单词
        <button onclick="exportEasyWords()">导出简单词并复制到剪贴板</button>
        <button onclick="exportHardWords()">
          导出不认识的词并复制到剪贴板
        </button>
      </div>
    </div>
    <hr />
    <div id="words"></div>
  </body>
  <script>
    let html = [];
    let hardWords = [];
    words.forEach((word) => {
      // 过滤掉简单词
      if (!easy.includes(word)) {
        html.push(generateWordDiv(word));
        hardWords.push(word);
      }
    });
    document.querySelector('#total').innerHTML = html.length;
    document.querySelector('#words').innerHTML = html.join('');
    addClickEvent();

    function generateWordDiv(word) {
      return `
    <div class="line" name="${word}">
        <div class="div_easy"><input id="easy-${word}" name="${word}"  type="radio" class="easy" /><label for="easy-${word}">简单</label></div>
        <div class="div_word">${word}</div>
        
        <div class="div_hard"><input id="hard-${word}" name="${word}"  type="radio" class="hard" /><label for="hard-${word}">困难</label></div>
        </div>
    `;
    }

    function exportEasyWords() {
      let easyWords = [];
      Array.prototype.slice
        .call(document.querySelectorAll('input[type=radio]'))
        .forEach((el) => {
          if (el.checked && el.className === 'easy') {
            easyWords.push(el.name);
          }
        });

      copy("'" + easyWords.join("',\r\n'") + "',");
    }

    function exportHardWords() {
      copy(hardWords.join('\r\n'));
    }

    function copy(str) {
      var save = function (e) {
        e.clipboardData.setData('text/plain', str); //下面会说到clipboardData对象
        e.preventDefault(); //阻止默认行为
      };
      document.addEventListener('copy', save);
      document.execCommand('copy'); //使文档处于可编辑状态，否则无效
    }

    /**
     * 需要在页面元素加载完成后才能调用
     */
    function addClickEvent() {
      Array.prototype.slice
        .call(document.querySelectorAll('.line'))
        .forEach((el) => {
          el.addEventListener(
            'click',
            function () {
              localStorage.setItem('last_word', el.getAttribute('name'));
              console.log(el.getAttribute('name'));

              el.style.backgroundColor = 'lightblue';
            },
            true
          );
        });
    }
  </script>
</html>
